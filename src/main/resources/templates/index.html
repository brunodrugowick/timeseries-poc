<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <link href='/webjars/bootstrap/css/bootstrap.min.css' rel='stylesheet'>
    <meta charset="UTF-8">
    <!--Load the AJAX API-->
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript" th:inline="javascript">
        // From https://medium.com/@reachansari/google-chart-example-with-spring-boot-cd25ead09bd3
        const real_data = /*[[${measurements}]]*/'noValue';

        google.charts.load('current', {'packages':['line']});
        google.charts.setOnLoadCallback(drawChart);

        function drawChart() {

            // Create the data table.
            var data = new google.visualization.DataTable();
            data.addColumn('datetime', 'Date');
            data.addColumn('number', 'High');
            data.addColumn('number', 'Low');

            Object.keys(real_data).forEach(function(key) {
                const epochDate = parseInt(key);
                data.addRow([ new Date(epochDate), real_data[key][0], real_data[key][1] ]);
            });
            data.sort([{column: 0}]);

            const options = {
                title: 'Blood Pressure Over Time',
                curveType: 'function',
                legend: {position: 'bottom'},
                hAxis: {
                    format: 'dd/MM HH:mm:ss'
                }
            };

            const chart = new google.charts.Line(document.getElementById('chart_div'));

            chart.draw(data, google.charts.Line.convertOptions(options));
        }

    </script>

    <title>My Blood Pressure</title>
</head>
<body>

<div th:replace="fragments/header :: header (${useremail})"></div>
<br>

<div class="container-fluid">
    <div class="container-fluid text-left">
        <div class="card shadow-sm">
            <div class="card-body">
                <h5 class="card-title">Measurements</h5>
                <div id="chart_div"></div>
                <a class="btn btn-primary"
                   style="white-space: nowrap"
                   href="/new">Add Measurement</a>
            </div>
        </div>
    </div>
</div>

<div class="container-fluid" id="footer">
    <br><br>
</div>

<script src="/webjars/bootstrap/js/bootstrap.min.js"></script>
</body>
</html>